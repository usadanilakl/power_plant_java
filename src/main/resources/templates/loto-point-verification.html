<!DOCTYPE html>
<html xmlns:th="<http://www.thymeleaf.org>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="/bootstrap-5.3.3-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/my_styles/home.css">
    <link rel="stylesheet" href="/my_styles/glow-buttons.css">
    <style>

        html, #main, #loto-point-table{
            width: 100%;
            height: 100%; 
        }

        #loto-point-table {
            height: 400px;
            overflow-y: auto;
        }

    </style>
</head>
<body>

    <div id="main">
        <div th:replace="~{partials/index::header}"></div>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12" id="loto-point-table">
                    
        
                </div>
            </div>
        </div>

    </div>



<script src="./bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
<script src="./functions/controllers/LotoPointController.js"></script>
<script src="./functions/service/TableSErvice.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
    let tableContainer = document.getElementById('loto-point-table');
    if (!tableContainer) {
        console.error('Table container not found');
        return;
    }

    try {
        let data = await getActiveLotoPoints();
        let items = data.map(e => ({
            tagNumber: e.tagNumber,
            description: e.description,
            generalLocation: e.generalLocation,
            specificLocation: e.specificLocation
        }));

        let ignoreFields = [];
        let table = createTableFromObjects(items, ignoreFields);
        
        tableContainer.appendChild(table);

        let lastScrollTop = 0;
        tableContainer.addEventListener('scroll', function() {
            const scrollPosition = this.scrollTop + this.clientHeight;
            const tableHeight = this.scrollHeight;
            let currentScrollTop = this.scrollTop;

            if (tableHeight - scrollPosition < 500 && currentScrollTop > lastScrollTop) {
                tableDisplayControl(table, false);
            } else if (this.scrollTop < 500 && currentScrollTop < lastScrollTop) {
                tableDisplayControl(table, true);
            }

            lastScrollTop = currentScrollTop;
        });

        console.log('Scroll event listener added');
    } catch (error) {
        console.error('Error loading table data:', error);
    }
});
    // window.addEventListener('load',async()=>{
    //     let tableContainer = document.getElementById('loto-point-table');
    //     let data = await getActiveLotoPoints();
    //     let items = [];
    //     for(let e of data){
    //         let item = {};
    //         item.tagNumber = e.tagNumber;
    //         item.description = e.description;
    //         item.generalLocation = e.generalLocation;
    //         item.specificLocation = e.specificLocation;
    //         items.push(item);
    //     }
    //     let ignoreFields = [];
    //     let table = createTableFromObjects(items, ignoreFields)
        
    //     tableContainer.appendChild(table);

    //     let lastScrollTop = 0

    //     tableContainer.addEventListener('scroll', function() {
    //         const scrollPosition = tableContainer.scrollTop + tableContainer.clientHeight;
    //         const tableHeight = tableContainer.scrollHeight;
    //         let currentScrollTop = tableContainer.scrollTop;

    //         // Check if the scroll position is within 100px of the bottom of the table
    //         if (tableHeight - scrollPosition < 500 && currentScrollTop>lastScrollTop) {
    //             tableDisplayControl(table, false);
    //         }else if(tableContainer.scrollTop < 500 && currentScrollTop<lastScrollTop){
    //             tableDisplayControl(table, true);
    //         }
    //         console.log(lastScrollTop);
    //         lastScrollTop = currentScrollTop;
    //         console.log(lastScrollTop);

    //     });
    // })

</script>
</body>
</html>